<!DOCTYPE html>
<html>
<head><title>Prolog в HTML с Tau Prolog</title></head>
<body>
  <h1>Търси животно по ID</h1>
  <input type="number" id="id" />
  <button onclick="search()">Търси</button>
  <pre id="output"></pre>

  <script src="https://unpkg.com/tau-prolog/modules/core.js"></script>
  <script src="https://unpkg.com/tau-prolog/modules/lists.js"></script>
  <script>
    let session;

    function initSession() {
      session = pl.create();
      session.consult(`
        animal(1, sss, ffff).
      `);
    }

    initSession();

    function search() {
      const id = document.getElementById('id').value.trim();
      const output = document.getElementById('output');
      if (!id) {
        output.textContent = 'Моля, въведете ID!';
        return;
      }

      const query = `animal(${id}, Name, Habitat).`;

      // Създаваме нова сесия за всяка заявка (за да е "чиста")
      initSession();

      session.query(query);

      session.answers(x => {
        if (x === false) {
          output.textContent = "Няма животно с това ID.";
        } else if (x === null) {
          // Няма повече отговори
        } else {
          // Взимаме стойностите от отговора
          let nameMatch = session.format_answer(x).match(/Name = '([^']+)'/);
          let habitatMatch = session.format_answer(x).match(/Habitat = '([^']+)'/);
          if (nameMatch && habitatMatch) {
            output.textContent = `Име: ${nameMatch[1]}\nСреда: ${habitatMatch[1]}`;
          } else {
            output.textContent = "Грешка при извличане на резултата.";
          }
        }
      });
    }
  </script>
</body>
</html>
